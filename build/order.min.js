var MAX_INT=9007199254740992,MIN_INT=-9007199254740992,require=void("1"===$("#hinh_thuc_nhan_hang").val()?($("#ho_ten").prop("required",!0),$("#thanh_pho").prop("required",!0),$("#quan").prop("required",!0),$("#dia_chi").prop("required",!0),0==$("label[for='ho_ten'] small span.require").length&&$("label[for='ho_ten'] small").append('<span class="require">*</span>'),0==$("label[for='thanh_pho'] small span.require").length&&$("label[for='thanh_pho'] small").append('<span class="require">*</span>'),0==$("label[for='quan'] small span.require").length&&$("label[for='quan'] small").append('<span class="require">*</span>'),0==$("label[for='dia_chi'] small span.require").length&&$("label[for='dia_chi'] small").append('<span class="require">*</span>')):($("#ho_ten").prop("required",!1),$("#thanh_pho").prop("required",!1),$("#quan").prop("required",!1),$("#dia_chi").prop("required",!1),$("label[for='ho_ten'] small span.require").remove(),$("label[for='thanh_pho'] small span.require").remove(),$("label[for='quan'] small span.require").remove(),$("label[for='dia_chi'] small span.require").remove()));function vMonney(e){return e.toLocaleString("vi-VN")}function clearCustomer(){$("#tuoi").val(""),$("#id").val(""),$("#dien_thoai_1").val(""),$("#ho_ten").val(""),$("#dien_thoai_2").val(""),$("#dia_chi").val(""),$("#email").val(""),$("#phuong").val(""),$("#quan").val(""),$("#thanh_pho").val(""),$("#short_description").val(""),$("#description").val(""),$("#gioi_tinh option:selected").prop("selected",!1),$("#thanh_pho").selectize()[0].selectize.clear(),$("#quan").prop("disabled",!0),$("#phuong").prop("disabled",!0)}function sumAddress(){var e=$("#dia_chi").val(),n=$("#thanh_pho option:selected").text(),a=""!=$("#thanh_pho option:selected").val()?", "+n:"",t=$("#quan option:selected").text(),i=""!=$("#quan option:selected").val()?", "+t:"",l=$("#phuong option:selected").text(),o=""!=$("#phuong option:selected").val()?", "+l:"";$("#summary_diachi").text(e+o+i+a)}$(function(){$("body").addClass("sidebar-collapse"),$("#ho_ten").on({"change keyup":function(e){var n=$(this).val();$("#summary_ten").text(n)}}),$("#dien_thoai_1").on({"change keyup":function(e){var n=$(this).val();$("#summary_phone1").text(n)}}),$("#dien_thoai_2").on({"change keyup":function(e){var n=$(this).val();$("#summary_phone2").text(n)}}),$("#dia_chi").on({"change keyup":function(e){sumAddress()}}),$("#dien_thoai_1").on("keyup blur focus",function(e){"keyup"==e.type&&($("#phone_list").html(""),$.post(window.location.origin+"/auth/customer/phone",{phone:$(this).val()},function(e){$("#phone_list").html("");var a="";$.each(e,function(e,n){a+='<li class="list-group-item phone">',a+='<a href="" data-id="'+n.id+'">'+n.dien_thoai_1+" - "+n.ho_ten+"</a>",a+="</li>"}),$("#phone_list").html(a)})),"blur"==e.type&&setTimeout(function(){$("#phone_s").css("display","none")},200),(e.type="focus")&&setTimeout(function(){$("#phone_s").css("display","block")},0)}),$("body").on("click","li.phone a",function(e){e.preventDefault(),setTimeout(function(){$("#phone_s").css("display","none")},300),$.post(window.location.origin+"/auth/customer/id",{id:$(this).data("id")},function(e){$("#id").val(e.id),$("#dien_thoai_1").val(e.dien_thoai_1),$("#dien_thoai_2").val(e.dien_thoai_2),$("#ho_ten").val(e.ho_ten),$("#dia_chi").val(e.dia_chi),$("#email").val(e.email),$("#tuoi").val(e.tuoi),$("#summary_ten").text(e.ho_ten),$("#summary_phone1").text(e.dien_thoai_1),$("#summary_phone2").text(e.dien_thoai_2),$("#summary_diachi").text(e.dia_chi),$("#thanh_pho")[0].selectize.setValue(e.thanh_pho),setTimeout(function(){$("select#quan option[value="+e.quan+"]").prop("selected",!0),$("#phuong").prop("disabled",!1)},200);var t=e.phuong;$.post(window.location.origin+"/auth/phuong",{title:e.quan},function(e){var a='<option value="">chọn phường/xã</option>';$.each(e,function(e,n){n.id==t?a+='<option selected value="'+n.id+'">'+n.full_title+"</option>":a+='<option value="'+n.id+'">'+n.full_title+"</option>"}),$("#phuong").html(""),$("#phuong").html(a)})})}),$("body").on("click",".btn-remove",function(e){e.preventDefault();var n=$(this).data("id");$("#"+n).remove(),$(this).closest("tr").remove();var a=0;$(".sum_tien").each(function(){a+=Number($(this).text().replace(/\./g,""))}),$("#sum_money").val(vMonney(a));var t=Number($("#iship").val().replace(/\./g,""));$("#last_money").val(vMonney(a+t))}),$(document).ready(function(){var e=0;$(".sum_tien").each(function(){e+=Number($(this).text().replace(/\./g,""))}),$("#sum_money").val(vMonney(e));var n=Number($("#iship").val().replace(/\./g,""));$("#last_money").val(vMonney(e+n))}),$("body").on("change",".qtys",function(e){e.preventDefault();var n=$(this).closest("tr").find(".ton").text();$(this).val()>parseInt(n)&&$(this).val(parseInt(n));var a=$(this).val();$(this).attr("value",parseInt(a));var t=parseInt($(this).closest("tr").find(".gia_one").val()),i=$(this).data("id");$("tr#"+i+" td.sum_tien").text(vMonney(a*t)),$("tr#"+i+" td.sum_sl").text(a);var l=0;$(".sum_tien").each(function(){l+=Number($(this).text().replace(/\./g,""))}),$("#sum_money").val(vMonney(l));var o=Number($("#iship").val().replace(/\./g,""));$("#last_money").val(vMonney(l+o))}),$("#iship").on("keyup",function(e){e.preventDefault();var n=Number($(this).val().replace(/\./g,""));if(MAX_INT<n||n<MIN_INT)return!1;$("#ship").val(n),$("#iship").val(vMonney(n));var a=parseInt($("#sum_money").val().replace(/\./g,""));null!=n&&$("#last_money").val(vMonney(a+n))}),$("body").on("click",".icb",function(e){$(this).parent().find("input").is(":checked")?$(this).closest("li").find("#km_input input").each(function(){$(this).prop("disabled",!1)}):$(this).closest("li").find("#km_input input").each(function(){$(this).prop("disabled",!0)})}),$("#hinh_thuc_nhan_hang").on("change",function(e){e.preventDefault(),"1"==$(this).val()?($("#ho_ten").prop("required",!0),$("#thanh_pho").prop("required",!0),$("#quan").prop("required",!0),$("#dia_chi").prop("required",!0),0==$("label[for='ho_ten'] small span.require").length&&$("label[for='ho_ten'] small").append('<span class="require">*</span>'),0==$("label[for='thanh_pho'] small span.require").length&&$("label[for='thanh_pho'] small").append('<span class="require">*</span>'),0==$("label[for='quan'] small span.require").length&&$("label[for='quan'] small").append('<span class="require">*</span>'),0==$("label[for='dia_chi'] small span.require").length&&$("label[for='dia_chi'] small").append('<span class="require">*</span>')):($("#ho_ten").prop("required",!1),$("#thanh_pho").prop("required",!1),$("#quan").prop("required",!1),$("#phuong").prop("required",!1),$("#dia_chi").prop("required",!1),$("label[for='ho_ten'] small span.require").remove(),$("label[for='thanh_pho'] small span.require").remove(),$("label[for='quan'] small span.require").remove(),$("label[for='phuong'] small span.require").remove(),$("label[for='dia_chi'] small span.require").remove())})}),$(function(){$("#thanh_pho").selectize({onChange:function(e){sumAddress(),$("#quan").prop("disabled",!1),$("#quan").html(""),$("#phuong").html(""),$("#phuong").append('<option value="">chọn phường/xã</option>'),$.post(window.location.origin+"/auth/quan",{title:e},function(e){$("#quan").append('<option value="">chọn quận/huyện</option>'),$.each(e,function(e,n){$("#quan").append('<option value="'+n.id+'">'+n.full_title+"</option>")})}),setTimeout(function(){$("#phuong").prop("disable",!0)},2e3)}}),$("#quan").on("change",function(){sumAddress(),$("#phuong").html(""),$("#phuong").prop("disabled",!1);var e=$("#quan").val();$.post(window.location.origin+"/auth/phuong",{title:e},function(e){$("#phuong").append('<option value="">chọn phường/xã</option>'),$.each(e,function(e,n){$("#phuong").append('<option value="'+n.id+'">'+n.full_title+"</option>")})})}),$("#phuong").on("change",function(){sumAddress()})}),$(".save-cus").on("click",function(e){if(e.preventDefault(),confirm("Lưu nhanh thông tin khách hàng?")){var n=$("#ho_ten").val(),a=$("#dien_thoai_1").val();if(!/^([0-9]{10,11})$/.test(a))return alert("Số điện thoại bạn nhập chưa hợp lệ!"),$("#dien_thoai_1").focus(),!1;var t=$("#dien_thoai_2").val(),i=$("#dia_chi").val(),l=$("#thanh_pho").val(),o=$("#quan").val(),p=$("#phuong").val(),h=$("#tuoi").val(),s=$("#gioi_tinh").val(),u=$("#email").val();console.log(n+a+t+i+l+o+p+h+s+u),$.post(window.location.origin+"/auth/customer",{ho_ten:n,dien_thoai_1:a,dien_thoai_2:t,dia_chi:i,thanh_pho:l,quan:o,phuong:p,tuoi:h,gioi_tinh:s,email:u},function(e,n){return 0==e.code?(alert("Khách hàng đã tồn tại!"),!1):1==e.code?(alert("Thêm khách hàng thành công"),!1):void("error"==n&&alert("Lỗi: Thêm thất bại!"))})}});var SEARCH_TIME_OUT=20,$=jQuery;function trimSpace(e){return e.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")}function trimSpecialCharacter(e){return e.replace(/!|@|\$|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\'| |\"|\&|\#|\[|\]|~/g," ")}function highlight(e,n){n=(n=trimSpace(n)).split(" ").join("|");var a=new RegExp("("+n+")","gi");return e.replace(a,"<span class='highlight'>$1</span>")}function resultSanPham(e,n){var a="";return $.each(e,function(e,n){a+='<li class="san_pham list-group-item">',a+='<h5><a data-id="'+n.id+'" data-ten="'+n.ten+'" data-msp="'+n.ma_san_pham+'">'+n.ten+" - "+n.ma_san_pham+"</a></h5>",a+="</li>"}),a}function getDataFromES(n,a){$.ajax({url:window.location.origin+"/suggest-order",dataType:"json",data:{term:trimSpecialCharacter(n)},success:function(e){0<e.length?($("#result").show(),a.html(resultSanPham(e,n))):a.empty()}})}$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var n=$(".thuoc"),e=$("#s");$('input[name="loai"]');$(document).on("click",function(e){"result"!=$(e.target).attr("id")&&$("#result").hide(),"s"===$(e.target).attr("id")&&$("#result").show()}),$("body").on("click","li.san_pham",function(e){e.preventDefault();var b=$(this).find("a").data("ten"),T=$(this).find("a").data("id"),q=$(this).find("a").data("msp");$.post(window.location.origin+"/auth/product/price",{msp:q},function(d){var r=d.dvt_default,c=d.gia_ban_default,m=d.dvt_lv1,_=d.dvt_lv2,v=d.dvt_lv3,g=d.ma_dvt_lv1,y=d.ma_dvt_lv2,f=d.ma_dvt_lv3;parseInt(d.price_dvt_lv1?d.price_dvt_lv1:d.price_dvt_lv2?d.price_dvt_lv2:d.price_dvt_lv3?d.price_dvt_lv3:0),c=parseInt(d.gia_ban_default);$.post(window.location.origin+"/auth/product/ton",{id:q},function(e){if($("#tb-search").has("tr#"+T+"-tb").length){var n=parseInt($("tr#"+T+"-tb td input.qtys").val())+1,a=parseInt($("tr#"+T+"-tb td input.ton_val").val()),t=parseInt($("tr#"+T+"-tb td input.gia_one").val());if(n<=a){$("tr#"+T+"-tb td input.qtys").attr("value",n),$("tr#"+T+"-tb td input.gia_val").val(t*n),$("#summary_tb tbody tr#"+T+" td.sum_tien").text(vMonney(n*t)),$("#summary_tb tbody tr#"+T+" td.sum_sl").text(n);var i=0;$(".sum_tien").each(function(){i+=Number($(this).text().replace(/\./g,""))}),$("#sum_money").val(vMonney(i));var l=Number($("#iship").val().replace(/\./g,""));$("#last_money").val(vMonney(i+l))}else console.log("reached limit");return!1}var o='<select name="don_vi_ban" class="form-control don_vi_ban">';o+=m?'<option value="'+g+'"'+(d.name_dvt_default===m?"selected":"")+">"+m+"</option>":"",o+=_?'<option value="'+y+'"'+(d.name_dvt_default===_?"selected":"")+">"+_+"</option>":"",o+=v?'<option value="'+f+'"'+(d.name_dvt_default===v?"selected":"")+">"+v+"</option>":"",o+="</select>";var p=0==e.ton?0:1,h=window.location.origin+"/auth/order/product/",s=(u="",$.ajax({type:"POST",global:!1,dataType:"JSON",url:window.location.origin+"/auth/order/exchange",data:{msp:q},success:function(e){u+=e.DVT_Lv1?e.DVT_Lv1:"",u+=e.DVT_Lv2?" - "+e.DVT_Lv2:""}}),u);$("#tb-search tbody").append('                        <tr id="'+T+'-tb">                            <td>                                <span><a target="_blank" href="'+h+T+'">'+b+" - "+q+'</a></span>                                <input type="hidden" name="product_names[]" value="'+b+'" >                                <input type="hidden" name="product_ids[]" value="'+T+'" >                                <input type="hidden" name="msps[]" value="'+q+'" >                                <input type="hidden" name="madvts[]" value="'+r+'">                                <br><span class="exchange">'+s+'</span>                            </td>                            <td>                                <input type="number" data-id="'+T+'" step="1" min="1" class="qtys form-control" name="qtys[]" value="'+p+'" style="width:100%">                            </td>                            <td>                                <span class="gia_don_vi">'+d.name_dvt_default+'</span>                            </td>                            <td>                                <span class="ton">'+e.ton+'</span>                                <input type="hidden" name="tonkho[]" class="ton_val" value="'+e.ton+'" style="width:100%">                            </td>                            <td>                                '+o+'                            </td>                            <td>                                <span class="gia">'+vMonney(c)+'</span>                                <input type="hidden" class="gia_val" name="gia[]" min="1" value="'+c+'" style="width:100%">                                <input type="hidden" class="gia_one" name="gia_one[]" value="'+c+'">                            </td>                            <td><a href="#" class="btn btn-danger btn-xs btn-remove" data-id="'+T+'"><i class="fa fa-close"></i></a></td>                        </tr>'),$("#s").val(""),1==p&&$("#summary_tb tbody").append('                            <tr id="'+T+'">                                <td>'+b+'</td>                                <td class="sum_sl">'+p+"</td>                                <td>"+d.name_dvt_default+"</td>                                <td>"+e.ton+"</td>                                <td>"+vMonney(c)+'</td>                                <td class="sum_tien">'+vMonney(1*c)+"</td>                            </tr>                        ");i=0;$(".sum_tien").each(function(){i+=Number($(this).text().replace(/\./g,""))}),$("#sum_money").val(vMonney(i));var u;l=Number($("#iship").val().replace(/\./g,""));$("#last_money").val(vMonney(i+l))})})});var a=null;e.keypress(function(e){if(13===(e.keyCode||e.which)&&0===$(this).val().length)return alert("Bạn chưa nhập từ khóa tìm kiếm"),$(this).focus(),!1}),e.keyup(function(){clearTimeout(a),0===$(this).val().length&&n.empty(),a=setTimeout(function(){e.autocomplete({minLength:1,source:function(e){getDataFromES(e.term,n)}})},SEARCH_TIME_OUT)})}),$(function(){$("#ngay_giao_hang").datetimepicker({format:"DD/MM/YYYY HH:mm:ss"})}),$("body").on("change",".don_vi_ban",function(e){e.preventDefault();var n=$(this).val(),t=$(this),a=$(this).closest("tr").find('td input[name="product_ids[]"]').val();$.post(window.location.origin+"/auth/order/dongia",{madvt:n,id:a},function(e,n){var a=parseInt(e.dvt);t.closest("tr").find(".gia").text(vMonney(a))})}),$("#cuahang_code").selectize({onChange:function(e){var i=[],l=[],n=[],a=[],t=[],o=new FormData;if($('input[name="product_names[]"]').each(function(){i.push($(this).val())}),0==i.length)return $("#ctkm").html(""),$("#ctkm").append('<li class="list-group-item text-center">                                    <span>Chưa chọn sản phẩm</span>                                </li>'),!1;$('input[name="qtys[]"]').each(function(){n.push(parseInt($(this).val()))}),$('input[name="msps[]"]').each(function(){l.push($(this).val())}),$('input[name="madvts[]"]').each(function(){a.push(parseInt($(this).val()))}),$('input[name="gia_one[]"]').each(function(){t.push(parseInt($(this).val()))}),o.append("product_names",i),o.append("msps",l),o.append("qtys",n),o.append("madvts",a),o.append("prices",t),o.append("shop",e),$.ajax({url:window.location.origin+"/auth/order/promotion",data:o,cache:!1,contentType:!1,processData:!1,type:"POST",beforeSend:function(){$("#ctkm").html(""),$("#ctkm").append('<li class="list-group-item text-center">                                    <span><i class="fa fa-refresh fa-spin" style="font-size:24px"></i></span>                                    </li>')},success:function(e){if(console.log(e),0==e)$("#ctkm").html(""),$("#ctkm").append('<li class="list-group-item">                        <span> Không có chương trình khuyến mãi </span>                        </li>');else{$("#ctkm").html("");for(var n=0;n<e.length;++n)if(0!==parseInt(e[n].tiengiam)){var a=l.indexOf(e[n].MaSP);$("#ctkm").append('<li class="list-group-item">                                        <input type="checkbox" class="icb" value="'+e[n].Cocau+'">                                        <span id="km_input">                                            <input type="hidden" disabled name="MaSP[]" value="'+e[n].MaSP+'">                                            <input type="hidden" disabled name="LineNum[]" value="'+e[n].LineNum+'">                                            <input type="hidden" disabled name="tiengiam[]" value="'+e[n].tiengiam+'">                                            <input type="hidden" disabled name="Cocau[]" value="'+e[n].Cocau+'">                                            <input type="hidden" disabled name="MaSP_Tangchinh[]" value="'+e[n].MaSP_Tangchinh+'">                                            <input type="hidden" disabled name="TenSP_Tangchinh[]" value="'+e[n].TenSP_Tangchinh+'">                                            <input type="hidden" disabled name="SL_TangChinh[]" value="'+e[n].SL_TangChinh+'">                                            <input type="hidden" disabled name="DVT_TangChinh[]" value="'+e[n].DVT_TangChinh+'">                                            <input type="hidden" disabled name="TenDVT_TangChinh[]" value="'+e[n].TenDVT_TangChinh+'">                                            <input type="hidden" disabled name="MaSP_Tangthaythe[]" value="'+e[n].MaSP_Tangthaythe+'">                                            <input type="hidden" disabled name="TenSP_Tangthaythe[]" value="'+e[n].TenSP_Tangthaythe+'">                                            <input type="hidden" disabled name="SL_Tangthaythe[]" value="'+e[n].SL_Tangthaythe+'">                                            <input type="hidden" disabled name="DVT_Tangthaythe[]" value="'+e[n].DVT_Tangthaythe+'">                                            <input type="hidden" disabled name="TenDVT_TangThayThe[]" value="'+e[n].TenDVT_TangThayThe+'">                                            <input type="hidden" disabled name="SL_Mua[]" value="'+e[n].SL_Mua+'">                                            <input type="hidden" disabled name="DVT_Mua[]" value="'+e[n].DVT_Mua+'">                                            <input type="hidden" disabled name="Ten_DVT[]" value="'+e[n].Ten_DVT+'">                                        </span>                                        <span> '+i[a]+" - Tiền giảm: "+vMonney(parseInt(e[n].tiengiam))+"</span>                                    </li>")}else{var t=e[n].TenSP_Tangchinh?"Tặng chính: "+e[n].TenSP_Tangchinh:e[n].TenSP_Tangthaythe?"Tặng thay thế: "+e[n].TenSP_Tangthaythe:"";$("#ctkm").append('<li class="list-group-item">                                        <input type="checkbox" class="icb" value="'+e[n].Cocau+'">                                        <span id="km_input">                                            <input type="hidden" disabled name="MaSP[]" value="'+e[n].MaSP+'">                                            <input type="hidden" disabled name="LineNum[]" value="'+e[n].LineNum+'">                                            <input type="hidden" disabled name="tiengiam[]" value="'+e[n].tiengiam+'">                                            <input type="hidden" disabled name="Cocau[]" value="'+e[n].Cocau+'">                                            <input type="hidden" disabled name="MaSP_Tangchinh[]" value="'+e[n].MaSP_Tangchinh+'">                                            <input type="hidden" disabled name="TenSP_Tangchinh[]" value="'+e[n].TenSP_Tangchinh+'">                                            <input type="hidden" disabled name="SL_TangChinh[]" value="'+e[n].SL_TangChinh+'">                                            <input type="hidden" disabled name="DVT_TangChinh[]" value="'+e[n].DVT_TangChinh+'">                                            <input type="hidden" disabled name="TenDVT_TangChinh[]" value="'+e[n].TenDVT_TangChinh+'">                                            <input type="hidden" disabled name="MaSP_Tangthaythe[]" value="'+e[n].MaSP_Tangthaythe+'">                                            <input type="hidden" disabled name="TenSP_Tangthaythe[]" value="'+e[n].TenSP_Tangthaythe+'">                                            <input type="hidden" disabled name="SL_Tangthaythe[]" value="'+e[n].SL_Tangthaythe+'">                                            <input type="hidden" disabled name="DVT_Tangthaythe[]" value="'+e[n].DVT_Tangthaythe+'">                                            <input type="hidden" disabled name="TenDVT_TangThayThe[]" value="'+e[n].TenDVT_TangThayThe+'">                                            <input type="hidden" disabled name="SL_Mua[]" value="'+e[n].SL_Mua+'">                                            <input type="hidden" disabled name="DVT_Mua[]" value="'+e[n].DVT_Mua+'">                                            <input type="hidden" disabled name="Ten_DVT[]" value="'+e[n].Ten_DVT+'">                                        </span>                                        <span>'+t+"</span>                                    </li>")}}},error:function(e,n){$("#ctkm").html(""),$("#ctkm").append('<li class="list-group-item">                    Load khuyến mãi thất bại: <span class="label label-danger">'+n+"</span>                    </li>")}})}});